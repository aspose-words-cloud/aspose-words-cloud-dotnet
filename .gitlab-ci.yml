stages:
  - build
  - tests

build:
  stage: build 
  script:
    # - docker system prune -f
    - docker build .\scripts -f .\scripts\build.Dockerfile -t netsdkbuild
    - cmd /c 'docker run -v "%cd%:C:/Build/" netsdkbuild c:\build\scripts\build.bat'     
  artifacts:
    paths: 
      - 'buildOut/*'
  tags:
    - words

tests:
  stage: tests  
  script: 
    - mkdir testResults 
    - mkdir Settings
    - echo "{""AppSid"":""$env:AppSid"",""AppKey"":""$env:AppKey"",""BaseUrl"":""$env:TestServerUrl"" }" > Settings/servercreds.json
    - tools\nunit\nunit3-console.exe buildOut\Aspose.Words.Cloud.Sdk.Tests.dll  --result="testResults\tests-result.xml;transform=tools\nunit\nunit3-junit.xslt"
  dependencies:
    - build
  artifacts:
    paths:       
      - 'testResults/tests-result.xml'   
      - 'testResults/bddtests-result.xml'   
    reports: 
      junit: 
        - 'testResults/tests-result.xml'   
        - 'testResults/bddtests-result.xml'   
  tags:
    - words

bddtests:
  stage: tests  
  script: 
    - mkdir testResults 
    - mkdir Settings
    - echo "{""AppSid"":""$env:AppSid"",""AppKey"":""$env:AppKey"",""BaseUrl"":""$env:TestServerUrl"" }" > Settings/servercreds.json
    - tools\nunit\nunit3-console.exe buildOut\Aspose.Words.Cloud.Sdk.BddTests.dll  --result="testResults\bddtests-result.xml;transform=tools\nunit\nunit3-junit.xslt"
  dependencies:
    - build
  artifacts:
    paths: 
      - 'testResults/bddtests-result.xml'   
    reports: 
      junit: 'testResults/bddtests-result.xml'   
  tags:
    - words    